<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>weather_city</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css"
    />
    <script src="jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
  </head>
  <body>
    <h1>台灣北部地區一周白天天氣溫度表</h1>
    <div style="width: 800px;">
      <canvas id="myChart" width="8" height="6"></canvas>
    </div>

    <script>
        let tp;
        let np;
        let kl;
        let ty;
        $.getJSON(
          "https://opendata.cwb.gov.tw/fileapi/v1/opendataapi/F-D0047-091?Authorization=CWB-7C299954-97FA-4586-9578-92F21F0F4760&downloadType=WEB&format=JSON"
        )
          .done((e) => {
            //   console.log(e);
            tp = e.cwbopendata.dataset.locations.location[16];
            np = e.cwbopendata.dataset.locations.location[18];
            kl = e.cwbopendata.dataset.locations.location[13];
            ty = e.cwbopendata.dataset.locations.location[21];
            //   console.log(tp, np, kl, ty);


            let p=new Array(),n=new Array(),k=new Array(),t=new Array(), timeline=new Array();      //建立各城市的資料空陣列


            for(let i=0;i<tp.weatherElement[0].time.length;i+=2){
              //   將溫度逐項塞入city陣列
              p.push(tp.weatherElement[0].time[i].elementValue.value);
              n.push(np.weatherElement[0].time[i].elementValue.value);
              k.push(kl.weatherElement[0].time[i].elementValue.value);
              t.push(ty.weatherElement[0].time[i].elementValue.value);

              //將時間文字塞入timeline
              //tp.weatherElement[0].time[0].startTime;
              timeline.push(tp.weatherElement[0].time[i].startTime.substr(0,10));
            }
            // console.log(timeline);
            // findmin=Math.min.apply(null,["p's min","n's min","k's min","t's min"])   //用此函式來找四個個陣列中最小的值,正是寫法為下方(做為顯示最大最小的溫度值用)
            findMin=Math.min.apply(null,[findMin=Math.min.apply(null,p),findMin=Math.min.apply(null,n),findMin=Math.min.apply(null,k),findMin=Math.min.apply(null,t)])
            findMax=Math.max.apply(null,[findMax=Math.max.apply(null,p),findMax=Math.max.apply(null,n),findMax=Math.max.apply(null,k),findMax=Math.max.apply(null,t)])

            // canvas
            var ctx = document.getElementById("myChart").getContext("2d");
            var myChart = new Chart(ctx, {
              type: "line",
              data: {
                labels: ["0728", "0729", "0730", "0731", "0801", "0802"],
                datasets: [
                  {
                    label: np.locationName,
                    data: n,
                    backgroundColor: ["rgba(255, 99, 132, 0.2)"],
                    borderColor: ["rgba(255, 99, 132, 1)"],
                    borderWidth: 1,
                  },
                  {
                    label: tp.locationName,
                    data: p,
                    backgroundColor: ["rgba(54, 162, 235, 0.2)"],
                    borderColor: ["rgba(54, 162, 235, 1)"],
                    borderWidth: 1,
                  },
                  {
                    label: kl.locationName,
                    data: k,
                    backgroundColor: ["rgba(255, 206, 86, 0.2)"],
                    borderColor: ["rgba(255, 206, 86, 1)"],
                    borderWidth: 1,
                  },
                  {
                    label: ty.locationName,
                    data: t,
                    backgroundColor: ["rgba(75, 192, 192, 0.2)"],
                    borderColor: ["rgba(75, 192, 192, 1)"],
                    borderWidth: 1,
                  }]
              },
              options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            //   beginAtZero: true
                            stepSize:0.2,
                            min: findMin -1,
                            max: findMax +1
                        }
                    }]
                }
                }
            });
          })
          .fail((e) => {
            console.log("it's fail.");
          });
    </script>
  </body>
</html>
