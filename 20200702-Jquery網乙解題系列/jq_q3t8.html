<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第三題.t8訂票</title>
    <!-- jQuery -->
<script src="jquery-3.5.1.min.js"></script>
<style>
    .box{
        background: url("img/03D04.png");
        width: 540px;
        height: 370px;
        box-sizing: border-box;
        padding: 19px 112px 11px;
        display: flex;
        flex-flow: row wrap;   /*橫向排列擠壓*/
        justify-content: space-between;
    }
    .box > label{
        flex:0 0 20%;   /*不要膨脹也不要收縮，每個位置站1/5*/
        height: 85px;
        display: flex;
        flex-flow: column nowrap;
        justify-content: space-between;
        align-items: center;  /*控制內容物(checkbox & text)左右*/
        cursor: pointer;
        font-size: 0.8rem;
    }
    .box input[type="checkbox"]{    /*當型態為 checkbox 時的選擇器*/
        align-self:flex-end;        /*做flex-end的調整*/
    }
</style>
</head>
<body>
    <form action="">
        <div class="box">
            <!-- <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label>
            <label style="background: url('img/03D02.png') no-repeat center;"> 
                <span>A 排 1 號</span>
                <input type="checkbox" name="buyseat[]" value="1">
            </label> -->
        </div>
        <hr>
        您選擇的電影是：<span id="mm"></span> <br>
        您選擇的時刻是：<span id="tt"></span> <br>
        
        您勾選<span id="nn">0</span>了張票,最多可購買 4 張票 <br>

        <input type="submit" value="確認訂票">
    
<!-- 這裡做後端回傳值的動作 -->
        <input type="hidden" name="title" value=""> <!-- 電影名稱 -->
        <input type="hidden" name="date" value="">  <!-- 日期 -->
        <input type="hidden" name="time" value="">  <!-- 場次 -->
        
    </form>
    <script>
        $.getJSON("data.json",function(result){
            todo(result.q3t8);
        })
        function todo(jsn){
            // console.log(jsn);
            let abcd=['A','B','C','D'];
            
            for(let i=1;i<21;i++){
                //i=17 => sRow=4 <=> (17-1)/5無捨+1,sCol=2 <=> (17-1)%5+1
                //i=20 => sRow=4 <=> (20-1)/5無捨+1,sCol=2 <=> (20-1)%5+1
               
                let sRow=Math.floor((i-1)/5+1); /*第?排*/
                let sCol=(i-1)%5+1; /*第?個位置*/

                /* 當下的i值去判斷sell陣列內有沒有存在
                   如果有存在就是被賣掉了，.append就不要輸出可以賣的畫面
                   反之，如果sell陣列沒有存在的話就可以賣
                */
            //    if(($.inArray(i,js.sell)<0)){
               if(jsn.sell.includes(i)){        //如果jsn內的sell陣列內有i的值直接吐出來
                //sellout
                     $(".box").append(`
                     <label style="background: url('img/03D03.png') no-repeat center;"> 
                        <span>${abcd[sRow-1]} 排 ${sCol} 號</span>
                     </label>
                     `);
                    }
                    else{
                        //onsell
                     $(".box").append(`
                     <label style="background: url('img/03D02.png') no-repeat center;"> 
                        <span>${abcd[sRow-1]} 排 ${sCol} 號</span>
                        <input type="checkbox" name="buyseat[]" value="${i}">
                     </label>
                     `);
                }
            }
            
            $("#mm").text(jsn.movie.title);
            $("#tt").text(jsn.movie.date+"   "+jsn.movie.time);
            $("input[name='title'").val(jsn.movie.title);
            $("input[name='date'").val(jsn.movie.date);
            $("input[name='time'").val(jsn.movie.time);

            // checked事件
            let num=0;

            $("input:checkbox").click(function(){     /*牽扯到本體，就不要用匿名函式*/
                /* 三元運算式 type--1--:*/
                // if (this.checked) num < 4 ? num++ : this.checked = false;
                // else num--;
                /* 三元運算式 type--2--:*/
                this.checked ? num <4 ? num++ : this.checked = false :num--;
                
                // if(this.checked){   /*先執行打勾，再來計算*/
                //     // 判別勾取最大額度為4超過即不能再勾選
                //     if(num < 4) num++;
                //     else this.checked = false;  
                // }
                // else num--;
                // $("#nn").text(num);
            })
        }
    </script>
</body>
</html>