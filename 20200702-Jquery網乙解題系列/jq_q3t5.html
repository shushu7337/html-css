<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第三題T.5</title>
</head>
<!-- jQuery -->
<script src="jquery-3.5.1.min.js"></script>
<body>
    <form action="check_q3t5.php" method="post" style="text-align: center;">
    <h3>預告片清單</h3>
        <table border="1" style="margin:0 auto;">
            <thead>
                <tr>
                    <th>預告片海報</th>
                    <th>預告片片名</th>
                    <th>播放順序</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <!-- <tr>                
                    <td><img src="img/03A01.jpg" width="100"></td>
                    <td>03A01</td>
                    <td>
                        <input type="hidden" name="odr[03A01" value="5">
                        <input type="button" value="上移" class="up">
                        <input type="button" value="下移" class="down">
                    </td>
                    <td>
                        <input type="checkbox">顯示
                        <input type="checkbox">刪除
                    </td>
                </tr> -->
            </tbody>
        </table>
        <div style="margin:10px 0"><input type="submit" value="編輯"></div>
    </form>
    <script>
        $.getJSON("data.json",function(result){
            // console.log(result);
            // todo(result.q3t5);
            for (const item of result.q3t5){
                // console.log(item);
                $("tbody").append(`
                <tr>                
                    <td><img src="${item.img}" width="100"></td>
                    <td>${item.text}</td>
                    <td>
                        <input type="hidden" name="odr[${item.img}" value="${item.odr}">
                        <input type="button" value="上移" class="up">
                        <input type="button" value="下移" class="down">
                    </td>
                    <td>
                        <input type="checkbox">顯示
                        <input type="checkbox">刪除
                    </td>
                </tr> 
                `);
            }

            $("input:button").click(function(){
                // console.log(nodeSelf);
                let nodeSelf = $(this).parents("tr");
                let nodeTarget =null;   //目標節點

                switch (this.className) {   //抓一個節點的classname
                    case "up":
                        nodeTarget=$(this).parents("tr").prev();    //找到前一個
                    if (nodeTarget.length == 1){
                    // 更改value值
                    
                    //  value-1
                        // valself=nodeSelf.find("input:hidden").val();    //找出原先value值
                        // valself --;
                        // nodeSelf.find("input:hidden").val(valself);     //減完後塞回去

                    // 合併寫法 type 1
                        // nodeSelf.find("input:hidden").val(function(idx,value){
                        //     return value--;
                        // })
                    // 合併寫法 type 2
                        nodeSelf.find("input:hidden").val((idx,value)=>{ return --value;})

                    // value+1
                        // valTar=nodeTarget.find("input:hidden").val();    //找出原先value值
                        // valTar ++;
                        // nodeTarget.find("input:hidden").val(valTar);     //加完後塞回去
                    nodeTarget.find("input:hidden").val((idx,value)=>{ return ++value;})

                    //=====================================================================================
                    
                    // 上移功能
                        nodeSelf.insertBefore(nodeTarget);  //將自己. insertBefore 插入(目標位置)前面
                    }
                        break;

                    case "down":
                    nodeTarget=$(this).parents("tr").next();    //找到前一個
                    if (nodeTarget.length == 1){
                    // 更改value值
                    
                        nodeSelf.find("input:hidden").val((idx,value)=>{ return ++value;})

                        nodeTarget.find("input:hidden").val((idx,value)=>{ return --value;})

                    //=====================================================================================
                    
                    // 上移功能
                        nodeSelf.insertAfter(nodeTarget); 
                         //將自己. insertBefore 插入(目標位置)前面
                    }
                        break;

                }

            });
        })
    </script>
</body>
</html>